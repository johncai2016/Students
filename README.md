<p><b>项目说明:</b></p>
   <p>本项目纯属公益，如果觉得里面的功能可以用上，欢迎使用</p>
   <p>由于疫情，老师需要收集开学前3天学生和同住人员的核酸检测记录，行程码，老师需要核对学生提交的信息是否正确，这需要花费老师很多的时间。</p>
   <p>因为没有办法自动获取到学生和同住人员的核酸记录，行程码信息。所以老师通常需要以小程序接龙的方式让家长提交相应的截图，然后再打开截图查看相关信息是否正确。这个小项目的目标主要就是给老师减轻负担，希望把大部分的数据核查能通过脚本自动完成。</p>
   <p>学生家长提交每天的核酸检测结果(含检测中),行程码，老师需要核对以下信息:</p>
   <p>1. 学生和同住人员数量，比如老师的excel中填写的是4人(含学生本人)，那提交的记录就应该有4份核酸记录，行程码不做数量检查</p>
   <p>2. 检查提交的核酸记录是否在某天之后的，比如必须是2022-4-2后，如果家长提交了3月31号的数据，这种情况要报告出来。</p>
   <p>3. 查找出核酸结果还在'检测中’的学生，因为有时候家长当天做的结果还没有出来，老师需要在第二天提醒学生家长重新提交结果。</p>
   <p>4. 检查学生家长行程码是否带星，主要是因为家长有时候会忘记跟老师报备，行程码带星的学生需要老师特别关注。</p>
   <p><b>准备资料：</b></p>
   <p>1. 家长当天提交截图的zip文件，因为老师都是通过微信接龙小程序完成的，接龙小程序有个功能可以导出所有学生的数据，导出数据的时候选择‘每个人一个目录’，这样每个目录就是每个学生的姓名，导出的数据就是zip格式的，可以直接上传使用，不需要老师额外处理。</p>
   <p>2. 一个excel表，第一列填写学生姓名，第二列填写同住人员数量(含学生本人)，此excel表不需要表头,如下(此步骤非必须，如果不需要对比提交的核酸记录数量可以跳过),这个表只需要收集一次即可重复使用，而且可以跟踪到同住人员数量变化。比如某段时间内，同住人员出差了或者老人回老家或者过来深圳了</p>
   <p>然后即可按照提示的步骤在几分钟内自动完成核查</p>
   <p><b>关于数据安全</b></p>
   <p>所有提交的原始数据，包括中间暂时存入数据库的数据，都可以在完成后点击‘删除数据’，本程序不会保留任何数据。</p>
   <p><b>项目部署</b></p>
   <p>python3 + django 4.0 + tesseract</p>
   <p><b>需要改进的地方</b></p>
   <p>还是希望有经验的朋友能把它改造成适合多个人使用(比如有性能好的服务器或者有没有限制的API调用次数，这样老师们就可以只需要把数据从小程序导出成zip压缩文件，然后上传到服务器就可以自动处理，老师只需要查看异常数据即可。</p>
   <p><b>常见问题</b></p>
   <p>1.如何保持后台允许?</p>
   <p>nohub python3 manage.py runserver 0.0.0.0:80 & </p>
   <p>2.如何部署到阿里云上?</p>
   <p>a.在setting中设置ALLOWED_HOSTS = ['你的阿里云公网IP','localhost','127.0.0.1','0.0.0.0:80']</p>
   <p>b.nohub python3 manage.py runserver 0.0.0.0:80 & </p>
   <p>c.检查安全组策略(也就是防火墙规则要放行对应的端口)</p>
   <p>3.文件夹或者文件解压后乱码的问题,可以通过下面的代码解决,因为发现在win10和ubuntu下需要使用不同的代码，所有干脆就用了try except</p>
   <p>try:
       new_name = old_name.encode('cp437').decode('gbk') </p>
   <p>except:
       new_name = old_name.encode('utf-8').decode('utf-8') </p>
   <p>4.linux下目录是通过'/',但是windows是'\'</p>
   <p>5.图片无法显示的问题</p>
   <p>发现django的图片显示要开启debug=True,所以想了个偷懒的方法，把代码上传到‘语雀’中再通过引用URL即可。在'语雀'中新建一个文件，然后插入图片上去，右键找到图片链接的url即可</p>
   <p>6. 图片识别速度太慢的问题</p>
   <p>用pytesseract,在阿里云上(1核2G内存，即使只是单线程去遍历读取每张图片，发现CPU很快就会达到接近100%,所以导致无法使用多线程，而且因为CPU使用过高，导致整体处理速度很慢(48个学生，每个学生只包含4张截图，就要耗掉差不多15分钟</p>
   <p>用baidu ocr API,好处是图片文字识别率高，占用CPU低，但是调用量有限制，超过要收费</p>
   <p>我把baidu API和开源的pytesseract识别的图片都做了些处理，后面对于识别到的文字处理逻辑是一样的</p>
   <p>7.如何从小程序导出zip文件</p>
   <p>第一步：在手机上的接龙小程序上点击'导出数据'</p>
   <p>第二步：点击'导出图片中的生成下载链接'</p>
   <p>第三步：选择具体一天日期的日期，点击'每人一个文件夹'，然后点击'确定'</p>
   <p>第四步：点击'复制下载链接'，把下载链接发到电脑端下载即可</p>
   <p><b>特别感谢:</b></p>
   <p>@小黑的帮忙，我遇到的很多问题不懂都是请教@小黑大佬的，谢谢他告诉我django这个框架,用起来真的很方便,也谢谢他帮我画的流程图，代码基本按这个流程写的(除了下载PDF这部分)</p>
   ![image](https://user-images.githubusercontent.com/23047196/165004913-829a1c89-c02b-4691-807f-4a6eb31ce804.png)

